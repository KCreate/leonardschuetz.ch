function _defineProperty(a,c,d){c in a?Object.defineProperty(a,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[c]=d;return a}function undefinedArray(a,c){return Array.from(Array(a)).map(function(){return c})}
var fieldModifiers=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],Minesweeper=function(){this.field=[];this.renderTarget=void 0;this.difficulty=4;this.bombsForField=function(a,c){var d=this;if(c>this.field.length-1||a>this.field[0].length-1||0>c||0>a||this.field[c][a].bomb)return 0;var f=0;fieldModifiers.forEach(function(e){d.field[c+e[1]]&&d.field[c+e[1]][a+e[0]]&&d.field[c+e[1]][a+e[0]].bomb&&f++});return f};this.configure=function(a){var c=this,d=a.fieldSize,f=a.renderTarget;this.difficulty=
a.difficulty;this.field=undefinedArray(d.y,undefinedArray(d.x,void 0));this.field=this.field.map(function(a,g){return a.map(function(a,d){return new function(a){var b=this;this.bomb=!Math.floor(Math.random()*Math.sqrt(2*a.difficulty));this.bombsAround=0;this.open=this.flagged=!1;this.game=a;this.x=d;this.y=g;this.leftClick=function(a){a=!1;window.alreadyModified||(a=!0,window.alreadyModified=[]);-1===window.alreadyModified.indexOf(b.x+"-"+b.y)&&(0!==b.bombsAround||b.bomb||fieldModifiers.forEach(function(a){b.game.field[b.y+
a[1]]&&b.game.field[b.y+a[1]][b.x+a[0]]&&(window.alreadyModified.push(b.x+"-"+b.y),b.game.field[b.y+a[1]][b.x+a[0]].leftClick({}))}));a&&(window.alreadyModified=void 0);b.bomb&&!b.flagged?b.game.loose():b.flagged||(b.open=!0,b.flagged=!1,b.game.render())};this.rightClick=function(a){a.preventDefault();b.open||(b.flagged=!b.flagged,b.game.render())}}(c)})});this.field=this.field.map(function(a,d){return a.map(function(a,e){return Object.assign(a,{bombsAround:c.bombsForField(e,d)})})});this.renderTarget=
f;this.loose=function(){alert("You have lost!");loadGame()}};this.render=function(){var a=this,c=this.field.map(function(a,c){var e=document.createElement("div");e.className="row";a.map(function(a,c){var d=_defineProperty({tile:!0,open:a.open,flagged:a.flagged},"bombs-"+a.bombsAround,!0),d=Object.keys(d).filter(function(a){return d[a]}).join(" "),e=document.createElement("div");e.className=d;e.onclick=a.leftClick;e.oncontextmenu=a.rightClick;!a.bomb&&a.open&&(e.innerHTML=a.bombsAround);return e}).forEach(function(a){e.appendChild(a)});
return e});this.renderTarget.innerHTML="";c.forEach(function(c){a.renderTarget.appendChild(c)})}};function loadGame(a){var c=new Minesweeper;c.configure(a||{fieldSize:{x:20,y:15},difficulty:Number(document.getElementById("difficultySelector").value),renderTarget:document.getElementById("app")});c.render()}loadGame();document.getElementById("difficultySelector").onchange=function(a){loadGame({fieldSize:{x:20,y:15},difficulty:Number(a.target.value),renderTarget:document.getElementById("app")})};
