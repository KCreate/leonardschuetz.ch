<!DOCTYPE html>
<!--
██   ██ ███████ ██      ██       ██████  ██ 
██   ██ ██      ██      ██      ██    ██ ██ 
███████ █████   ██      ██      ██    ██ ██ 
██   ██ ██      ██      ██      ██    ██    
██   ██ ███████ ███████ ███████  ██████  ██ 
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Day 2 of Advent of Code 2025 in Charly</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Leonard Schütz">
    <meta name="description" content="Day 2 of Advent of Code 2025 in
Charly">
    <meta name="keywords" content="leonard schütz, programming, compilers, ">
    <meta name="language" content="English">
    <meta name="contact" content="hello@leonard.swiss">
    <meta name="date" content="Mon, 02 Dec 2025 13:15:00 +0100">

    <meta property="og:url" content="https://leonard.swiss/">
    <meta property="og:title" content="Day 2 of Advent of Code 2025 in Charly">
    <meta property="og:description" content="Day 2 of Advent of Code
2025 in Charly">
    <meta property="og:site_name" content="Leonard Schütz">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_US">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@leni4838">
    <meta name="twitter:title" content="Day 2 of Advent of Code 2025 in Charly">
    <meta name="twitter:description" content="Day 2 of Advent of Code
2025 in Charly">

    <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico'/>
    <link rel="stylesheet" type="text/css" href="/resources/css/style.css"/>
    <link rel="alternate" type="application/rss+xml" title="Blog" href="/feed.xml" />
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">

      </head>
  <body>
    <div id="content">
      <header>
        <div id="name-container">
          <a href="/">leonard schütz</a>
        </div>
        <nav>
          <a href="/about">about</a>
          <a href="/blog/">blog</a>
        </nav>
      </header>
      <main class="blog-article">
<h1 id="advent-of-code-2025-in-charly">Advent of Code 2025 in
Charly</h1>
<h2 id="day-2">Day 2</h2>
<p><a href="../">Back to the main article</a></p>
<p>Todays task involved determining the set of invalid IDs from a list
of ID-ranges. An ID was invalid if its string representation consisted
of two repeated substrings of equal length.</p>
<p>E.g. <code>55</code>, <code>123123</code>, <code>827827</code> are
all invalid IDs.</p>
<p>The second part modified the challenge to instead define an invalid
ID as a repetition of <code>N</code> equally-sized substrings.</p>
<p>I solved the problem by looping over each ID in the provided ranges,
determining the sets of potential substrings that could form the entire
ID and then checking if that ID actually consists only of <code>N</code>
repetitions of that substring.</p>
<p>Charly does support concurrent and parallel execution of code, which
I attempted at first, but the overhead of that implementation almost
doubled the execution time, so I left it at a single-threaded
implementation.</p>
<div>
<iframe frameborder="0" scrolling="no" style="width:100%; height:554px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2FKCreate%2Fadvent-of-code-2025-charly%2Fblob%2Fmain%2Fdays%2Fday2%2Fday2.ch&amp;style=github-dark&amp;type=code&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on&amp;maxHeight=500">
</iframe>
</div>
<h2 id="changes-to-the-stdlib-vm">Changes to the stdlib / VM</h2>
<p>The only additions to the standard library today were the
<code>Int::upTo</code> and <code>List::notEmpty</code> methods. You can
see the implementations of those methods below:</p>
<div>
<iframe frameborder="0" scrolling="no" style="width:100%; height:412px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2FKCreate%2Fcharly-vm%2Fblob%2F6f940e22b405433ba47063359ecf0f07307fdbfc%2Fsrc%2Fcharly%2Fstdlib%2Fboot.ch%23L162-L177&amp;style=github-dark&amp;type=code&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on&amp;maxHeight=500">
</iframe>
</div>
<div>
<iframe frameborder="0" scrolling="no" style="width:100%; height:97px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2FKCreate%2Fcharly-vm%2Fblob%2Fbc4080d66c110a5cc463b759930aa470e72e60fe%2Fsrc%2Fcharly%2Fstdlib%2Fboot.ch%23L388&amp;style=github-dark&amp;type=code&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on&amp;maxHeight=500">
</iframe>
</div>
<p>The individual commits can be found here:</p>
<ul class="incremental">
<li><a
href="https://github.com/KCreate/charly-vm/commit/6f940e22b405433ba47063359ecf0f07307fdbfc"><code>6f940e2</code></a>
<code>Added Int::upTo</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/bc4080d66c110a5cc463b759930aa470e72e60fe"><code>bc4080d</code></a>
<code>Added List::notEmpty</code></li>
</ul>
<h2 id="late-night-addendum">Late-night Addendum</h2>
<blockquote>
<p>Charly does support concurrent and parallel execution of code, which
I attempted at first, but the overhead of that implementation almost
doubled the execution time, so I left it at a single-threaded
implementation.</p>
</blockquote>
<p>This didn’t quite sit right with me, so I investigated a bit. It
turned out that that the runtime was heavily bottlenecked by mutex
locks/unlocks, caused by the VM accessing the global list of object
shape instances and reading to / writing from global variables.</p>
<p>I’ve removed locks where possible, added a per-processor shape
caching layer and also replaced the default
<code>std::unordered_map</code> hashtable used for global variables with
<a
href="https://github.com/greg7mdp/parallel-hashmap/tree/master">greg7mdp/parallel-hashmap</a>.</p>
<p>These changes, alongside some minor tweaks to the implementation of
the puzzle solving code, brought down execution time by around
<strong><code>60%</code></strong>. Multi-threading the execution also
resulted in a measurable performance improvement, altough not as much as
I would’ve liked.</p>
<p>Below you can see the updated implementation of todays puzzle:</p>
<div>
<iframe frameborder="0" scrolling="no" style="width:100%; height:554px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2FKCreate%2Fadvent-of-code-2025-charly%2Fblob%2Fmain%2Fdays%2Fday2%2Fday2-parallel.ch&amp;style=github-dark&amp;type=code&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on&amp;maxHeight=500">
</iframe>
</div>
<p>And all the commits that made up tonights late-night hacking
session:</p>
<ul class="incremental">
<li><a
href="https://github.com/KCreate/charly-vm/commit/29bc22a2d413a3b1588908493bd2a8c38532562f"><code>29bc22a</code></a>
<code>Implemented per-proc shape lookup cache</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/d752e6eb4b3f2ada7ef722db4b4716d90071d64c"><code>d752e6e</code></a>
<code>Use parallel_hashmap for global variables</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/5c2c36ad87b3416e0a3dc62ff90feb31045a3259"><code>5c2c36a</code></a>
<code>Add List::any</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/c7ffd2eff03493f574e56b05aef34925e543dc72"><code>c7ffd2e</code></a>
<code>Add List::flatten</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/3a061014221c7c19d415f119567a5bf03998b61b"><code>3a06101</code></a>
<code>Add List::parallelMap and Int::parallelMap</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/387dea62a9f8954a9083f52ed162a76e3d874b6c"><code>387dea6</code></a>
<code>Add Int::parallelTimes</code></li>
<li><a
href="https://github.com/KCreate/charly-vm/commit/20590534828981282ad1731455fd429cdfecc092"><code>2059053</code></a>
<code>Add Int::collectUpTo</code></li>
</ul>
<h2 id="even-later-late-night-addendum">Even later late-night
Addendum</h2>
<p>I had to revert some previous changes, because my previous commits
caused some crazy unpredictable segfaults to happen. While I don’t
believe the locking I added back in again truly solved the issue,
they’re merely masking it, I do kind of need a semi-working language to
solve the upcoming puzzles.</p>
<p>I shall revisit this at a later time.</p>
<ul class="incremental">
<li><a
href="https://github.com/KCreate/charly-vm/commit/908f02c7bfd4add1cf9cc9e16cbcb9d0603a4cc5"><code>908f02c</code></a>
<code>Added locks around builtin class logic again</code></li>
</ul>
<h2 id="links">Links</h2>
<ul class="incremental">
<li><a href="https://github.com/KCreate/charly-vm">Charly Programming
Language</a></li>
<li><a
href="https://github.com/KCreate/advent-of-code-2025-charly/blob/main/days/day2/day2.ch">Source
code for todays challenge</a></li>
<li><a
href="https://github.com/KCreate/advent-of-code-2025-charly/blob/main/days/day2/day2-parallel.ch">Source
code for todays challenge (parallel)</a></li>
</ul>
      </main>
      <hr/>
      <footer>
        <div id="social-links">
          <a href="https://github.com/KCreate" target="_blank">
            <img height="20" width="20" src="/resources/github.svg" alt="GitHub Link"/>
          </a>
          <a href="https://linkedin.com/in/leonardschuetz" target="_blank">
            <img height="20" width="20" src="/resources/linkedin.svg" alt="LinkedIn Link"/>
          </a>
          <a href="mailto:hello@leonard.swiss?subject=Hello%20Leonard!">
            <img height="20" width="20" src="/resources/mail.svg" alt="Email Link"/>
          </a>
          <a href="/rss.xml" target="_blank">
            <img height="20" width="20" src="/resources/rss.svg" alt="RSS Link"/>
          </a>
        </div>
        <div id="open-source-notice">
          <span>this blog is <a href="https://github.com/KCreate/leonardschuetz.ch" target="_blank">open-source</a></span>
        </div>
      </footer>
      <span id="copyright">Copyright © 2024 - 2025 Leonard Schütz | <a href="/attributions">Attributions</a></span>
    </div>
  </body>
  <script src="/script.js" async></script>
</html>
